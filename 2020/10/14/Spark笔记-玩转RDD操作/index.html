<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"marchboy.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="RDD（Resilient Distributed Dataset）译作弹性分布式数据集，是Spark中最常用的数据抽象，是一个只可读、可分区、可并行计算的数据集合。RDD允许将工作集缓存在内存中进行复用，大大地提升了查询速度。  RDD简介1、MapReduce 在面对日益复杂的业务逻辑时已经表现出严重的不足：1.1）维护成本高昂，每一次数据处理都需要编写复杂的Map和Reduce步骤，中间某">
<meta property="og:type" content="article">
<meta property="og:title" content="Spark笔记-玩转RDD操作">
<meta property="og:url" content="https://marchboy.github.io/2020/10/14/Spark%E7%AC%94%E8%AE%B0-%E7%8E%A9%E8%BD%ACRDD%E6%93%8D%E4%BD%9C/index.html">
<meta property="og:site_name" content="ComputerScience">
<meta property="og:description" content="RDD（Resilient Distributed Dataset）译作弹性分布式数据集，是Spark中最常用的数据抽象，是一个只可读、可分区、可并行计算的数据集合。RDD允许将工作集缓存在内存中进行复用，大大地提升了查询速度。  RDD简介1、MapReduce 在面对日益复杂的业务逻辑时已经表现出严重的不足：1.1）维护成本高昂，每一次数据处理都需要编写复杂的Map和Reduce步骤，中间某">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://marchboy.github.io/2020/10/14/Spark%E7%AC%94%E8%AE%B0-%E7%8E%A9%E8%BD%ACRDD%E6%93%8D%E4%BD%9C/Spark-Scheduling-Process.png">
<meta property="article:published_time" content="2020-10-14T09:02:25.000Z">
<meta property="article:modified_time" content="2020-10-21T13:41:27.422Z">
<meta property="article:author" content="进军要努力呀">
<meta property="article:tag" content="Spark">
<meta property="article:tag" content="RDD">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://marchboy.github.io/2020/10/14/Spark%E7%AC%94%E8%AE%B0-%E7%8E%A9%E8%BD%ACRDD%E6%93%8D%E4%BD%9C/Spark-Scheduling-Process.png">

<link rel="canonical" href="https://marchboy.github.io/2020/10/14/Spark%E7%AC%94%E8%AE%B0-%E7%8E%A9%E8%BD%ACRDD%E6%93%8D%E4%BD%9C/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Spark笔记-玩转RDD操作 | ComputerScience</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-74793810-1"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-74793810-1');
      }
    </script>


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?a5f7448ac0b523badc121b2d870f1b0c";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">ComputerScience</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">温故而知新</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://marchboy.github.io/2020/10/14/Spark%E7%AC%94%E8%AE%B0-%E7%8E%A9%E8%BD%ACRDD%E6%93%8D%E4%BD%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="进军要努力呀">
      <meta itemprop="description" content="可怕的是自己内心的堕落">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ComputerScience">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Spark笔记-玩转RDD操作
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-10-14 17:02:25" itemprop="dateCreated datePublished" datetime="2020-10-14T17:02:25+08:00">2020-10-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-10-21 21:41:27" itemprop="dateModified" datetime="2020-10-21T21:41:27+08:00">2020-10-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spark/" itemprop="url" rel="index"><span itemprop="name">Spark</span></a>
                </span>
            </span>

          
            <span id="/2020/10/14/Spark%E7%AC%94%E8%AE%B0-%E7%8E%A9%E8%BD%ACRDD%E6%93%8D%E4%BD%9C/" class="post-meta-item leancloud_visitors" data-flag-title="Spark笔记-玩转RDD操作" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2020/10/14/Spark%E7%AC%94%E8%AE%B0-%E7%8E%A9%E8%BD%ACRDD%E6%93%8D%E4%BD%9C/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/10/14/Spark%E7%AC%94%E8%AE%B0-%E7%8E%A9%E8%BD%ACRDD%E6%93%8D%E4%BD%9C/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>9.4k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>9 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <blockquote>
<p>RDD（Resilient Distributed Dataset）译作<strong>弹性分布式数据集</strong>，是Spark中最常用的数据抽象，是一个只可读、可分区、可并行计算的数据集合。RDD允许将工作集缓存在内存中进行复用，大大地提升了查询速度。</p>
</blockquote>
<h2 id="RDD简介"><a href="#RDD简介" class="headerlink" title="RDD简介"></a>RDD简介</h2><p>1、MapReduce 在面对日益复杂的业务逻辑时已经表现出严重的不足：<br>1.1）维护成本高昂，每一次数据处理都需要编写复杂的Map和Reduce步骤，中间某一步骤出错就要重试以处理异常；<br>1.2）难以上手，造成处理性能低；</p>
<p>2、因此人们提出用<font color="red"><strong>有向无环图（DAG）</strong></font>来抽象表达复杂的数据处理逻辑，各个数据处理步骤表示成图中的节点与边依赖关系，形成数据流的抽象表示，而把复杂的性能优化提交给后台自动处理；</p>
<p>3、RDD也即分布式对象集合，是一个<strong>只读</strong>的分区记录集合，每个RDD可以划分成多个<strong>分区</strong>，每个分区就是数据集的一部分，同时不同分区可以存储在集群中不同的节点上，从而利用集群节点优势进行并行计算；</p>
<p>4、RDD提供了丰富的操作以支持常见的数据处理，即<code>“转换”（Transformation）和“行动”（Action）</code>两种类型操作：</p>
<ul>
<li><font color="red"><strong>转换操作：指定RDD的依赖关系，通过接受RDD并返回RDD，即从一个RDD转换到另外一个RDD；</strong></font></li>
<li><font color="red"><strong>行动操作：执行计算并指定输出的形式，通过接受RDD返回输出值或结果（非RDD）；</strong></font></li>
</ul>
<p>5、通过Spark的API可以使用不同的语言调用RDD的操作，常见过程流程如下：</p>
<ul>
<li>从各种数据源创建RDD；</li>
<li>对RDD指定一系列的转换操作；</li>
<li>最后调用行动操作，输出结果或写入外部数据源；</li>
</ul>
<p>6、RDD操作的<font color="red"><strong>惰性机制</strong></font>，是指在RDD执行操作时，只有触发<code>行动操作</code>才会做真正的计算，而在行动前的所有转换操作都只是记录下相互的依赖关系，形成数据流的管道化（pipeline），而不会做真正的计算；</p>
<img src="/2020/10/14/Spark%E7%AC%94%E8%AE%B0-%E7%8E%A9%E8%BD%ACRDD%E6%93%8D%E4%BD%9C/Spark-Scheduling-Process.png" alt="SparkRDD的执行过程" title="SparkRDD的执行过程">



<h2 id="RDD的创建"><a href="#RDD的创建" class="headerlink" title="RDD的创建"></a>RDD的创建</h2><h3 id="通过数据集合转化为RDD"><a href="#通过数据集合转化为RDD" class="headerlink" title="通过数据集合转化为RDD"></a>通过数据集合转化为RDD</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sc = SparkContext(<span class="string">&quot;local&quot;</span>, <span class="string">&quot;create_rdd&quot;</span>)</span><br><span class="line"></span><br><span class="line">ints = [<span class="number">1</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>]</span><br><span class="line">rdd = sc.parallelize(ints)</span><br><span class="line"><span class="comment"># parallelize()函数将一个List列表转化为了一个RDD对象</span></span><br><span class="line"></span><br><span class="line">strings = [<span class="string">&#x27;spark&#x27;</span>,<span class="string">&#x27;hadoop&#x27;</span>,<span class="string">&#x27;rdd&#x27;</span>]</span><br><span class="line">rdd_1 = sc.parallelize(strings, <span class="number">2</span>)</span><br><span class="line"><span class="comment"># parallelize()函数的第二个参数表示分区，默认是1，此处为2，表示将列表对应的RDD对象分为两个区。</span></span><br><span class="line"><span class="comment"># 后面的glom()函数就是要显示出RDD对象的分区情况，可以看出分了两个区，如果没有glom()函数，则不显示分区，如第一个结果所示。</span></span><br></pre></td></tr></table></figure>


<h3 id="从HDFS数据源或本地文件创建"><a href="#从HDFS数据源或本地文件创建" class="headerlink" title="从HDFS数据源或本地文件创建"></a>从HDFS数据源或本地文件创建</h3><p>从一篇CNN新闻报道 <a target="_blank" rel="noopener" href="https://us.cnn.com/2019/04/11/tech/uber-lyft-businesses/index.html">Uber and Lyft may look the same, but their visions are not</a> 中抽取新闻主体并放到文件<code>news_sep.txt</code>中，一段话为一行。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">At first blush, it can be hard to tell Uber and ...</span><br><span class="line">But look under the hood and there&#39;s a clear difference ...</span><br><span class="line">Uber filed paperwork on Thursday for what is expected ...</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>通过指定文件路径读取为RDD：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sc = SparkContext(<span class="string">&quot;local&quot;</span>, <span class="string">&quot;create_rdd&quot;</span>)</span><br><span class="line"><span class="comment"># 从本地文件系统地址加载</span></span><br><span class="line"></span><br><span class="line">rdd = sc.textFile(<span class="string">&quot;file:///path/to/news_sep.txt&quot;</span>)</span><br><span class="line"><span class="comment"># 从分布式文件系统HDFS地址加载，下面三种方式等价</span></span><br><span class="line"></span><br><span class="line">rdd = sc.textFile(<span class="string">&quot;hdfs://localhost:9000/path/to/news_sep.txt&quot;</span>)</span><br><span class="line">rdd = sc.textFile(<span class="string">&quot;/path/to/news_sep.txt&quot;</span>)</span><br><span class="line">rdd = sc.textFile(<span class="string">&quot;news_sep.txt&quot;</span>)</span><br></pre></td></tr></table></figure>


<h3 id="从其他数据库读取数据创建"><a href="#从其他数据库读取数据创建" class="headerlink" title="从其他数据库读取数据创建"></a>从其他数据库读取数据创建</h3><p>（待更新）</p>
<h3 id="使用数据流创建"><a href="#使用数据流创建" class="headerlink" title="使用数据流创建"></a>使用数据流创建</h3><p>结合流数据处理技术，如Spark Streaming、Kafka以及flume等，通过接收实时的输入数据流创建RDD。</p>
<h2 id="一般RDD的转换操作（Transformation）"><a href="#一般RDD的转换操作（Transformation）" class="headerlink" title="一般RDD的转换操作（Transformation）"></a>一般RDD的转换操作（Transformation）</h2><p><a target="_blank" rel="noopener" href="http://spark.apache.org/docs/latest/rdd-programming-guide.html#transformations">官方API文档</a>详细列出转换操作函数，下面简单介绍RDD常用的转换操作：</p>
<h3 id="flatMap"><a href="#flatMap" class="headerlink" title="flatMap()"></a>flatMap()</h3><p><code>flatMap(func)</code>：对于每一个输入元素，通过指定函数映射到0或多个元素，输出新的RDD。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将上述新闻文本的每一行每一段话根据空格进行分词</span></span><br><span class="line">rdd = rdd.flatMap(<span class="keyword">lambda</span> line: line.split(<span class="string">&quot; &quot;</span>))</span><br></pre></td></tr></table></figure>


<h3 id="map"><a href="#map" class="headerlink" title="map()"></a>map()</h3><p><code>map(func)</code>：对于每一个输入元素，通过执行指定函数映射到唯一输出（1v1关系），产生新的RDD。</p>
<ul>
<li><p>map()类似于Python中的map，针对RDD对应的列表的每一个元素，进行map()函数里面的尼玛函数（这个函数是map函数的一个参数）对应的操作，返回的仍然是一个RDD对象；</p>
</li>
<li><p>reduce()则是针对RDD对应的列表中的元素，递归地选择第一个和第二个元素进行操作，操作的结果作为一个元素用来替换这两个元素，注意，reduce返回的是一个Python可以识别的对象，非RDD对象。</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对上述分词结果的RDD中每一个单词去除标点符号，并转化为小写</span></span><br><span class="line">rdd = rdd.<span class="built_in">map</span>(<span class="keyword">lambda</span> w: w.strip(<span class="string">&quot;\&quot;&quot;</span>).strip(<span class="string">&quot;,&quot;</span>).strip(<span class="string">&quot;.&quot;</span>).lower())</span><br></pre></td></tr></table></figure>


<h3 id="filter"><a href="#filter" class="headerlink" title="filter()"></a>filter()</h3><p><code>filter(func)</code>：是对RDD元素进行过滤，把经过指定函数后返回值为true的元素组成一个新的RDD。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对上述结果筛选掉一些常见的介词，如</span></span><br><span class="line">rm_words = [<span class="string">&quot;and&quot;</span>,<span class="string">&quot;in&quot;</span>,<span class="string">&quot;at&quot;</span>,<span class="string">&quot;a&quot;</span>,<span class="string">&quot;an&quot;</span>,<span class="string">&quot;is&quot;</span>,<span class="string">&quot;are&quot;</span>,<span class="string">&quot;may&quot;</span>,<span class="string">&quot;that&quot;</span>,<span class="string">&quot;this&quot;</span>,<span class="string">&quot;to&quot;</span>,<span class="string">&quot;as&quot;</span>,<span class="string">&quot;with&quot;</span>,<span class="string">&quot;of&quot;</span>,<span class="string">&quot;can&quot;</span>,<span class="string">&quot;be&quot;</span>]</span><br><span class="line">rdd = rdd.<span class="built_in">filter</span>(<span class="keyword">lambda</span> w: w <span class="keyword">not</span> <span class="keyword">in</span> rm_words)</span><br></pre></td></tr></table></figure>


<h3 id="distinct"><a href="#distinct" class="headerlink" title="distinct()"></a>distinct()</h3><p><code>distinct([numPartitions])</code>：对数据进行去重，返回一个新的RDD，numPartitions参数用于设置任务并行数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 输出新闻中所有提及过的单词</span></span><br><span class="line">rdd = rdd.distinct(<span class="number">2</span>)</span><br></pre></td></tr></table></figure>


<h3 id="sample"><a href="#sample" class="headerlink" title="sample()"></a>sample()</h3><p><code>sample(withReplacement,fraction,seed=None)</code>：对数据进行采样，withReplacement参数表示是否放回抽样；fraction参数表示抽样比例；seed表示随机种子。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 随机抽取新闻提及部分单词</span></span><br><span class="line">rdd1 = rdd.sample(<span class="literal">False</span>, <span class="number">0.2</span>, <span class="number">2019</span>)</span><br></pre></td></tr></table></figure>


<h3 id="union"><a href="#union" class="headerlink" title="union()"></a>union()</h3><p><code>union(otherRDD)</code>：可以与另一个RDD数据集合并，合并后并不会去掉重复的数值，它返回一个新的RDD。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rdd1 = sc.parallelize([<span class="string">&quot;union&quot;</span>,<span class="string">&quot;other&quot;</span>,<span class="string">&quot;rdd&quot;</span>])</span><br><span class="line">rdd = rdd.union(rdd1)</span><br></pre></td></tr></table></figure>


<h3 id="intersection"><a href="#intersection" class="headerlink" title="intersection()"></a>intersection()</h3><p><code>intersection(otherRDD)</code>：可以与另一个RDD数据集进行求交集计算，返回新的RDD。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rdd1 = sc.parallelize([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>])</span><br><span class="line">rdd2 = sc.parallelize([<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>])</span><br><span class="line">rdd3 = rdd1.intersection(rdd2)</span><br><span class="line"><span class="comment"># 最后rdd3的结果为 [3,4,5]</span></span><br></pre></td></tr></table></figure>


<h3 id="subtract"><a href="#subtract" class="headerlink" title="subtract()"></a>subtract()</h3><p><code>subtract(otherRDD,[numPartitions])</code>：是对otherRDD进行减法操作，将原始RDD的元素减去新输入RDD的元素，将差值返回新RDD。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rdd1 = sc.parallelize([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>])</span><br><span class="line">rdd2 = sc.parallelize([<span class="number">2</span>,<span class="number">4</span>])</span><br><span class="line">rdd3 = rdd1.subtract(rdd2)</span><br><span class="line"><span class="comment"># 最后rdd3的结果为 [1,3,5]</span></span><br></pre></td></tr></table></figure>


<h3 id="cartesian"><a href="#cartesian" class="headerlink" title="cartesian()"></a>cartesian()</h3><p><code>cartesian(otherRDD)</code>：可以对两个RDD数据集U，V求笛卡尔积，返回一个新的RDD数据集，其中每个元素为(u,v)。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rdd1 = sc.parallelize([<span class="number">1</span>,<span class="number">2</span>])</span><br><span class="line">rdd2 = sc.parallelize([<span class="number">3</span>,<span class="number">4</span>])</span><br><span class="line">rdd3 = rdd1.cartesian(rdd2)</span><br><span class="line"><span class="comment"># 最后rdd3的结果为 [(1,3),(1,4),(2,3),(2,4)]</span></span><br></pre></td></tr></table></figure>


<h2 id="键值对RDD的转换操作（Transformation）"><a href="#键值对RDD的转换操作（Transformation）" class="headerlink" title="键值对RDD的转换操作（Transformation）"></a>键值对RDD的转换操作（Transformation）</h2><h3 id="map-1"><a href="#map-1" class="headerlink" title="map()"></a>map()</h3><p><code>map(func)</code>：操作可以将一般RDD转换为键值对RDD，元素变成(K,V)。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对上述新闻分词结果的RDD中每一个单词转化为(w,1)键值对</span></span><br><span class="line">rdd = rdd.<span class="built_in">map</span>(<span class="keyword">lambda</span> w: (w,<span class="number">1</span>))</span><br></pre></td></tr></table></figure>


<h3 id="reduceByKey"><a href="#reduceByKey" class="headerlink" title="reduceByKey()"></a>reduceByKey()</h3><p><code>reduceByKey(func,[numPartitions])</code>：可以对具有相同键的值进行合并，返回一个新的键值对RDD，numPartitions用于设置任务并行数。</p>
<p>需要区分的是：<br>reduce()最终只返回一个值，reduceByKey()和reduceByKeyLocally()均是将Key相同的元素合并。<br>区别在于，reduce()和reduceByKeyLocally()函数均是将RDD转化为非RDD对象，而reduceByKey()将RDD对象转化为另一个RDD对象，需要collect()函数才能输出。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对新闻出现过的单词进行词频统计</span></span><br><span class="line">rdd = rdd.reduceByKey(<span class="keyword">lambda</span> w1,w2: w1+w2)</span><br></pre></td></tr></table></figure>


<h3 id="groupByKey"><a href="#groupByKey" class="headerlink" title="groupByKey()"></a>groupByKey()</h3><p><code>groupByKey([numPartitions])</code>：可以对具有相同键的值进行分组，返回一个元素为(K,[Iterable])的键值对RDD，numPartitions用于指定任务并行数，默认为8。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对新闻出现过的单词进行词频统计</span></span><br><span class="line">rdd = rdd.groupByKey()</span><br></pre></td></tr></table></figure>


<h3 id="aggregateByKey"><a href="#aggregateByKey" class="headerlink" title="aggregateByKey()"></a>aggregateByKey()</h3><p><code>aggregateByKey(zeroValue,seqFunc,combFunc,[numPartitions])</code>：可以对具有相同键的值进行聚合，把(K,V)键值对RDD转换为新的(K,U)键值对RDD，其中U由给定的combFunc和中立零值zeroValue聚合而成，U可以有与V不一致的形式；</p>
<ul>
<li>zeroValue 可以是0如果聚合的目的是求和，可以是List如果目的是对值进行统合，可以是Set如果目的是聚合唯一值；</li>
<li>seqFunc: (U,V) =&gt; U 对分区内的元素进行聚合（操作发生在每个分区内部）；</li>
<li>combFunc: (U,U) =&gt; U 对不同分区的聚合结果做进一步的聚合（操作发生在全部分区的聚合结果间）；</li>
<li>numPartitions 用于设置任务并行数；</li>
</ul>
<blockquote>
<p>为什么使用两个函数？见<a target="_blank" rel="noopener" href="https://backtobazics.com/big-data/spark/apache-spark-aggregatebykey-example/">Apache Spark aggregateByKey Example</a></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 同样对新闻出现过的单词进行词频统计</span></span><br><span class="line">rdd = rdd.aggregateByKey(<span class="number">0</span>,<span class="keyword">lambda</span> v1,v2: v1+v2, <span class="keyword">lambda</span> a1,a2: a1+a2)</span><br></pre></td></tr></table></figure>


<h3 id="combineByKey"><a href="#combineByKey" class="headerlink" title="combineByKey()"></a>combineByKey()</h3><p><code>combineByKey(createCombiner,mergeValue,mergeCombiners,[numPartitions])</code>：可以对具有相同键的值按照自定义函数的逻辑进行聚合，把(K,V)键值对RDD转换为新的(K,U)键值对RDD，U可以有与V不一致的形式；</p>
<ul>
<li>createCombiner: V =&gt; C 创建新的聚合器方便后续步骤操作，对原始值进行附加操作并返回，跟flatMap()类似；</li>
<li>mergeValue: (C,V) =&gt; C 对分区内的元素进行聚合（操作发生在每个分区内部）；</li>
<li>mergeCombiners: (C,C) =&gt; C 对不同分区的聚合结果做进一步的聚合（操作发生在全部分区的聚合结果间）；</li>
<li>numPartitions 用于设置任务并行数；</li>
</ul>
<blockquote>
<p>groupByKey(), groupByKey(), aggregateByKey() 等都不同程度上依赖于 combineByKey() 操作</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对词频统计的结果求频数均值，例如</span></span><br><span class="line">strings = [<span class="string">&#x27;spark&#x27;</span>,<span class="string">&#x27;hadoop&#x27;</span>,<span class="string">&#x27;rdd&#x27;</span>,<span class="string">&#x27;rdd&#x27;</span>,<span class="string">&#x27;spark&#x27;</span>,<span class="string">&#x27;rdd&#x27;</span>]</span><br><span class="line">rdd = sc.parallelize(strings)</span><br><span class="line">rdd = rdd.<span class="built_in">map</span>(<span class="keyword">lambda</span> w: (w,<span class="number">1</span>))</span><br><span class="line">rdd = rdd.reduceByKey(<span class="keyword">lambda</span> v1,v2: v1 + v2)</span><br><span class="line">rdd = rdd.combineByKey(<span class="keyword">lambda</span> v: (<span class="number">1</span>,v), <span class="keyword">lambda</span> c, v: (c[<span class="number">0</span>]+<span class="number">1</span>,c[<span class="number">1</span>]+v), <span class="keyword">lambda</span> c1, c2: (c1[<span class="number">0</span>]+c1[<span class="number">0</span>],c2[<span class="number">1</span>]+c2[<span class="number">1</span>]))</span><br><span class="line"><span class="comment"># 最后的结果为 [(&#x27;spark&#x27;, (1, 2)), (&#x27;hadoop&#x27;, (1, 1)), (&#x27;rdd&#x27;, (1, 3))]</span></span><br></pre></td></tr></table></figure>


<h3 id="sortByKey"><a href="#sortByKey" class="headerlink" title="sortByKey()"></a>sortByKey()</h3><p><code>sortByKey(ascending,[numPartitions])</code>：可以对键值对RDD按照键进行排序操作，其中K需要实现Ordered方法。</p>
<ul>
<li>ascending 决定RDD中的元素按升序还是降序排序，默认是True升序；</li>
<li>numPartitions 用于设置任务并行数；</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对词频统计结果按降序排序（先把K-V值互换）</span></span><br><span class="line">rdd = rdd.<span class="built_in">map</span>(<span class="keyword">lambda</span> v: (v[<span class="number">1</span>],v[<span class="number">0</span>]))</span><br><span class="line">rdd = rdd.sortByKey(<span class="literal">False</span>)</span><br><span class="line">rdd = rdd.<span class="built_in">map</span>(<span class="keyword">lambda</span> v: (v[<span class="number">1</span>],v[<span class="number">0</span>]))</span><br></pre></td></tr></table></figure>
<h3 id="keys-与values"><a href="#keys-与values" class="headerlink" title="keys()与values()"></a>keys()与values()</h3><p><code>keys(),values()</code>：分别把键值对RDD的key和value返回形成一个新的RDD。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获得上一步排序结果的key或value</span></span><br><span class="line">rdd = rdd.keys()</span><br><span class="line">rdd = rdd.values()</span><br></pre></td></tr></table></figure>


<h3 id="mapValues"><a href="#mapValues" class="headerlink" title="mapValues()"></a>mapValues()</h3><p><code>mapValues(func)</code>：可以对键值对RDD每个元素的value加载到预定义函数进行操作，而不改变key。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 例如对词频统计结果值都减去1</span></span><br><span class="line">rdd = rdd.mapValues(<span class="keyword">lambda</span> v: v - <span class="number">1</span>)</span><br></pre></td></tr></table></figure>


<h3 id="join"><a href="#join" class="headerlink" title="join()"></a>join()</h3><p><code>join(otherRDD,[numPartitions])</code>：与关系数据库查询一样，表示内连接，给定两个键值对RDD如(K,V1)和(K,V2)，对于两个数据集都存在的key才对其输出，得到一个新的RDD，元素为(K,(V1,V2))。除此以外，还包括其他情形：</p>
<ul>
<li>fullOuterJoin(otherRDD,[numPartitions]) 全连接</li>
<li>leftOuterJoin(otherRDD,[numPartitions]) 左外连接</li>
<li>rightOuterJoin(otherRDD,[numPartitions]) 右外连接</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rdd1 = sc.parallelize([(<span class="string">&#x27;spark&#x27;</span>,<span class="number">1</span>),(<span class="string">&#x27;hadoop&#x27;</span>,<span class="number">1</span>)])</span><br><span class="line">rdd2 = sc.parallelize([(<span class="string">&#x27;spark&#x27;</span>,<span class="number">1</span>)])</span><br><span class="line">rdd1 = rdd1.join(rdd2)</span><br><span class="line"><span class="comment"># 最后结果为 [(&#x27;spark&#x27;, (1,1))]</span></span><br></pre></td></tr></table></figure>
<h2 id="RDD的行动操作（Action）"><a href="#RDD的行动操作（Action）" class="headerlink" title="RDD的行动操作（Action）"></a>RDD的行动操作（Action）</h2><p><a target="_blank" rel="noopener" href="http://spark.apache.org/docs/latest/rdd-programming-guide.html#actions">官方API文档</a>详细列出行动操作函数，下面简单介绍常用的行动操作：</p>
<h3 id="count"><a href="#count" class="headerlink" title="count()"></a>count()</h3><p><code>count()</code>：返回RDD数据集中元素的个数。</p>
<h3 id="collect"><a href="#collect" class="headerlink" title="collect()"></a>collect()</h3><p><code>collect()</code>：以数组的形式返回RDD数据集的所有元素。</p>
<h3 id="first"><a href="#first" class="headerlink" title="first()"></a>first()</h3><p><code>first()</code>：返回RDD数据集的第一个元素。</p>
<p>top()</p>
<p><code>top(num,key=None)</code>：以数组的形式返回RDD数据集的前num个元素，默认按<strong>降序</strong>，或者通过key函数指定。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">rdd = sc.parallelize([<span class="number">5</span>,<span class="number">24</span>,<span class="number">3</span>,<span class="number">12</span>,<span class="number">46</span>])</span><br><span class="line">print(rdd.takeOrdered(<span class="number">3</span>))</span><br><span class="line"><span class="comment"># 输出 [46,24,12]</span></span><br><span class="line">rdd = sc.parallelize([<span class="number">5</span>,<span class="number">24</span>,<span class="number">3</span>,<span class="number">12</span>,<span class="number">46</span>])</span><br><span class="line">print(rdd.takeOrdered(<span class="number">3</span>, key=<span class="built_in">str</span>))</span><br><span class="line"><span class="comment"># 输出 [5,46,3]</span></span><br></pre></td></tr></table></figure>


<h3 id="take"><a href="#take" class="headerlink" title="take()"></a>take()</h3><p><code>take(num)</code>：以数组的形式返回RDD数据集的前num个元素。</p>
<h3 id="takeOrdered"><a href="#takeOrdered" class="headerlink" title="takeOrdered()"></a>takeOrdered()</h3><p><code>takeOrdered(num,key=None)</code>：以数组的形式返回RDD数据集的前nu</p>
<p>m个元素，默认按<strong>升序</strong>排序，或者通过key函数指定。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">rdd = sc.parallelize([<span class="number">5</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">4</span>])</span><br><span class="line">print(rdd.takeOrdered(<span class="number">3</span>))</span><br><span class="line"><span class="comment"># 输出 [1,2,3]</span></span><br><span class="line">rdd = sc.parallelize([<span class="number">5</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">4</span>])</span><br><span class="line">print(rdd.takeOrdered(<span class="number">3</span>, key=<span class="keyword">lambda</span> x: -x))</span><br><span class="line"><span class="comment"># 输出 [5,4,3]</span></span><br></pre></td></tr></table></figure>


<h3 id="takeSample"><a href="#takeSample" class="headerlink" title="takeSample()"></a>takeSample()</h3><p><code>takeSample(withReplacement,num,seed=None)</code>：对RDD数据集进行采样，并以数组的形式返回，withReplacement参数表示是否放回抽样；num参数表示抽样个数；seed表示随机种子。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rdd = sc.parallelize([<span class="number">5</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">4</span>])</span><br><span class="line">print(rdd.takeSample(<span class="literal">False</span>,<span class="number">3</span>,seed=<span class="number">2019</span>))</span><br></pre></td></tr></table></figure>


<h3 id="lookup"><a href="#lookup" class="headerlink" title="lookup()"></a>lookup()</h3><p><code>lookup(key)</code>：以数组的形式返回键值对RDD中键为key的所有值，如果RDD数据集经过特定转换操作按照key进行了分区，那么此行动操作效率会很高。</p>
<h3 id="foreach"><a href="#foreach" class="headerlink" title="foreach()"></a>foreach()</h3><p><code>foreach(func)</code>：将RDD数据集中的每个元素加载到指定函数进行操作，无返回值。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对转换结果逐个输出</span></span><br><span class="line">rdd.foreach(<span class="built_in">print</span>)</span><br></pre></td></tr></table></figure>


<h3 id="reduce"><a href="#reduce" class="headerlink" title="reduce()"></a>reduce()</h3><p><code>reduce(func)</code>：通过指定函数（如求和、统计）对RDD数据集元素进行聚合。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对所有元素进行求和</span></span><br><span class="line"><span class="built_in">sum</span> = rdd.reduce(<span class="keyword">lambda</span> v1,v2: v1 + v2)</span><br></pre></td></tr></table></figure>


<h3 id="aggregate"><a href="#aggregate" class="headerlink" title="aggregate()"></a>aggregate()</h3><p><code>aggregate(zeroValue,seqOp,combOp)</code>：对RDD数据集的元素进行聚合，不要求返回值类型与RDD类型一致；</p>
<ul>
<li>zeroValue: U 给定初始值，形式与最终返回值U一致；</li>
<li>seqOp: (U,V) =&gt; U 对分区内的元素进行聚合（操作发生在每个分区内部）；</li>
<li>combOp: (U,U) =&gt; U 对不同分区的聚合结果做进一步的聚合（操作发生在全部分区的聚合结果间）；</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 求一个数组元素的均值</span></span><br><span class="line">rdd = sc.parallelize([<span class="number">5</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">4</span>])</span><br><span class="line">res = rdd.aggregate((<span class="number">0</span>,<span class="number">0</span>), <span class="keyword">lambda</span> u,v: (u[<span class="number">0</span>]+v,u[<span class="number">1</span>]+<span class="number">1</span>), <span class="keyword">lambda</span> u1,u2: (u1[<span class="number">0</span>]+u2[<span class="number">0</span>],u1[<span class="number">1</span>]+u2[<span class="number">1</span>]))</span><br><span class="line">print(res[<span class="number">0</span>]/res[<span class="number">1</span>])</span><br></pre></td></tr></table></figure>
<h3 id="countByKey"><a href="#countByKey" class="headerlink" title="countByKey()"></a>countByKey()</h3><p><code>countByKey()</code>：以字典的形式返回键值对RDD数据集中每个键的元素的统计数，即(K,count)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rdd = sc.parallelize([(<span class="string">&quot;rdd&quot;</span>,<span class="number">1</span>),(<span class="string">&quot;rdd&quot;</span>,<span class="number">2</span>),(<span class="string">&quot;spark&quot;</span>,<span class="number">2</span>)])</span><br><span class="line">res = rdd.countByKey()</span><br><span class="line"><span class="comment"># 输出结果 &#123;&#x27;rdd&#x27;: 2, &#x27;spark&#x27;: 1&#125;</span></span><br></pre></td></tr></table></figure>


<h3 id="countByValue"><a href="#countByValue" class="headerlink" title="countByValue()"></a>countByValue()</h3><p><code>countByValue()</code>：以字典的形式返回RDD数据集中每个元素的统计数，即(V,count)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rdd = sc.parallelize([<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">1</span>])</span><br><span class="line">res = rdd.countByValue()</span><br><span class="line"><span class="comment"># 输出结果 &#123;2: 2, 3: 1, 1: 2&#125;</span></span><br></pre></td></tr></table></figure>


<h3 id="saveAsTextFile"><a href="#saveAsTextFile" class="headerlink" title="saveAsTextFile()"></a>saveAsTextFile()</h3><p><code>saveAsTextFile(path, compressionCodecClass=None)</code>：把RDD数据集保存为文本文件，并可以指定是否压缩。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">f = NamedTemporaryFile(delete=<span class="literal">True</span>)</span><br><span class="line">f.close()</span><br><span class="line">codec = <span class="string">&quot;org.apache.hadoop.io.compress.GzipCodec&quot;</span></span><br><span class="line">sc.parallelize([<span class="string">&#x27;spark&#x27;</span>, <span class="string">&#x27;rdd&#x27;</span>]).saveAsTextFile(f.name, codec)</span><br></pre></td></tr></table></figure>


<h2 id="RDD的持久化"><a href="#RDD的持久化" class="headerlink" title="RDD的持久化"></a>RDD的持久化</h2><ul>
<li>由于RDD采用惰性机制，每次遇到行动操作都会根据DAG的依赖关系从头开始执行计算，如果遇到迭代计算，需要重复调用中间数据，会造成极大的计算开销；</li>
<li>可以通过持久化操作来解决以上的问题，用<code>persist()</code>方法对需要重复使用的RDD标记为持久化，当遇到第一次行动操作后，会把计算结果持久化，保存在计算节点的内存备用；</li>
</ul>
<h3 id="persist"><a href="#persist" class="headerlink" title="persist()"></a>persist()</h3><p><code>persist(storageLevel)</code>：storageLevel参数表示持久化级别，通过使用不同的级别可以把数据缓存到不同的位置，详见 <a target="_blank" rel="noopener" href="http://spark.apache.org/docs/latest/rdd-programming-guide.html#rdd-persistence">RDD Persistence</a>；其中使用<code>cache()</code>函数会调用默认的持久化方法，即<code>persist(MEMORY_ONLY)</code>将RDD作为反序列化的对象存储在JVM中；而<code>unpersist()</code>方法则可以把持久化的RDD从缓存中删除。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">rdd = sc.parallelize([<span class="string">&#x27;spark&#x27;</span>,<span class="string">&#x27;rdd&#x27;</span>,<span class="string">&#x27;hadoop&#x27;</span>])</span><br><span class="line">rdd.cache()</span><br><span class="line">print(rdd.take(<span class="number">1</span>))</span><br><span class="line"><span class="comment"># 第一次行动操作，触发完整计算，同时把rdd放入缓存</span></span><br><span class="line"><span class="comment"># 输出 [&#x27;spark&#x27;]</span></span><br><span class="line">print(rdd.collect())</span><br><span class="line"><span class="comment"># 第二次行动操作，此时直接重复利用上述的缓存rdd</span></span><br><span class="line"><span class="comment"># 输出 [&#x27;spark&#x27;,&#x27;rdd&#x27;,&#x27;hadoop&#x27;]</span></span><br><span class="line">rdd.unpersist()</span><br></pre></td></tr></table></figure>




<p>**Reference: **</p>
<p>1、<a target="_blank" rel="noopener" href="https://yxnchen.github.io/technique/Spark%E7%AC%94%E8%AE%B0-%E7%8E%A9%E8%BD%ACRDD%E6%93%8D%E4%BD%9C/">Spark笔记-玩转RDD操作</a></p>

    </div>

    
    
    <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;"> ------ 本文结束------</div>
    
</div>
        <div class="reward-container">
  <div>Donate comment here.</div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.png" alt="进军要努力呀 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.png" alt="进军要努力呀 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>进军要努力呀
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://marchboy.github.io/2020/10/14/Spark%E7%AC%94%E8%AE%B0-%E7%8E%A9%E8%BD%ACRDD%E6%93%8D%E4%BD%9C/" title="Spark笔记-玩转RDD操作">https://marchboy.github.io/2020/10/14/Spark笔记-玩转RDD操作/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

        

  <div class="followme">
    <p>欢迎关注我的其它发布渠道</p>

    <div class="social-list">

        <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
        </div>
    </div>
  </div>


      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/Spark/" rel="tag"><i class="fa fa-tag"></i> Spark</a>
              <a href="/tags/RDD/" rel="tag"><i class="fa fa-tag"></i> RDD</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/10/12/epoch-batchSize-iterations/" rel="prev" title="epoch-batchSize-iterations">
      <i class="fa fa-chevron-left"></i> epoch-batchSize-iterations
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/10/20/Spark%E7%AC%94%E8%AE%B0-%E7%8E%A9%E8%BD%ACSparkSQL/" rel="next" title="Spark笔记-玩转SparkSQL">
      Spark笔记-玩转SparkSQL <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
      <div class="tabs tabs-comment">
        <ul class="nav-tabs">
            <li class="tab"><a href="#comment-gitalk">gitalk</a></li>
            <li class="tab"><a href="#comment-valine">valine</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane gitalk" id="comment-gitalk">
              <div class="comments" id="gitalk-container"></div>
            </div>
            <div class="tab-pane valine" id="comment-valine">
              <div class="comments" id="valine-comments"></div>
            </div>
        </div>
      </div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#RDD%E7%AE%80%E4%BB%8B"><span class="nav-number">1.</span> <span class="nav-text">RDD简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RDD%E7%9A%84%E5%88%9B%E5%BB%BA"><span class="nav-number">2.</span> <span class="nav-text">RDD的创建</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%9A%E8%BF%87%E6%95%B0%E6%8D%AE%E9%9B%86%E5%90%88%E8%BD%AC%E5%8C%96%E4%B8%BARDD"><span class="nav-number">2.1.</span> <span class="nav-text">通过数据集合转化为RDD</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%8EHDFS%E6%95%B0%E6%8D%AE%E6%BA%90%E6%88%96%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6%E5%88%9B%E5%BB%BA"><span class="nav-number">2.2.</span> <span class="nav-text">从HDFS数据源或本地文件创建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%8E%E5%85%B6%E4%BB%96%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE%E5%88%9B%E5%BB%BA"><span class="nav-number">2.3.</span> <span class="nav-text">从其他数据库读取数据创建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%95%B0%E6%8D%AE%E6%B5%81%E5%88%9B%E5%BB%BA"><span class="nav-number">2.4.</span> <span class="nav-text">使用数据流创建</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E8%88%ACRDD%E7%9A%84%E8%BD%AC%E6%8D%A2%E6%93%8D%E4%BD%9C%EF%BC%88Transformation%EF%BC%89"><span class="nav-number">3.</span> <span class="nav-text">一般RDD的转换操作（Transformation）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#flatMap"><span class="nav-number">3.1.</span> <span class="nav-text">flatMap()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#map"><span class="nav-number">3.2.</span> <span class="nav-text">map()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#filter"><span class="nav-number">3.3.</span> <span class="nav-text">filter()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#distinct"><span class="nav-number">3.4.</span> <span class="nav-text">distinct()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sample"><span class="nav-number">3.5.</span> <span class="nav-text">sample()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#union"><span class="nav-number">3.6.</span> <span class="nav-text">union()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#intersection"><span class="nav-number">3.7.</span> <span class="nav-text">intersection()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#subtract"><span class="nav-number">3.8.</span> <span class="nav-text">subtract()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cartesian"><span class="nav-number">3.9.</span> <span class="nav-text">cartesian()</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%94%AE%E5%80%BC%E5%AF%B9RDD%E7%9A%84%E8%BD%AC%E6%8D%A2%E6%93%8D%E4%BD%9C%EF%BC%88Transformation%EF%BC%89"><span class="nav-number">4.</span> <span class="nav-text">键值对RDD的转换操作（Transformation）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#map-1"><span class="nav-number">4.1.</span> <span class="nav-text">map()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#reduceByKey"><span class="nav-number">4.2.</span> <span class="nav-text">reduceByKey()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#groupByKey"><span class="nav-number">4.3.</span> <span class="nav-text">groupByKey()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#aggregateByKey"><span class="nav-number">4.4.</span> <span class="nav-text">aggregateByKey()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#combineByKey"><span class="nav-number">4.5.</span> <span class="nav-text">combineByKey()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sortByKey"><span class="nav-number">4.6.</span> <span class="nav-text">sortByKey()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#keys-%E4%B8%8Evalues"><span class="nav-number">4.7.</span> <span class="nav-text">keys()与values()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mapValues"><span class="nav-number">4.8.</span> <span class="nav-text">mapValues()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#join"><span class="nav-number">4.9.</span> <span class="nav-text">join()</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RDD%E7%9A%84%E8%A1%8C%E5%8A%A8%E6%93%8D%E4%BD%9C%EF%BC%88Action%EF%BC%89"><span class="nav-number">5.</span> <span class="nav-text">RDD的行动操作（Action）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#count"><span class="nav-number">5.1.</span> <span class="nav-text">count()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#collect"><span class="nav-number">5.2.</span> <span class="nav-text">collect()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#first"><span class="nav-number">5.3.</span> <span class="nav-text">first()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#take"><span class="nav-number">5.4.</span> <span class="nav-text">take()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#takeOrdered"><span class="nav-number">5.5.</span> <span class="nav-text">takeOrdered()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#takeSample"><span class="nav-number">5.6.</span> <span class="nav-text">takeSample()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#lookup"><span class="nav-number">5.7.</span> <span class="nav-text">lookup()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#foreach"><span class="nav-number">5.8.</span> <span class="nav-text">foreach()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#reduce"><span class="nav-number">5.9.</span> <span class="nav-text">reduce()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#aggregate"><span class="nav-number">5.10.</span> <span class="nav-text">aggregate()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#countByKey"><span class="nav-number">5.11.</span> <span class="nav-text">countByKey()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#countByValue"><span class="nav-number">5.12.</span> <span class="nav-text">countByValue()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#saveAsTextFile"><span class="nav-number">5.13.</span> <span class="nav-text">saveAsTextFile()</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RDD%E7%9A%84%E6%8C%81%E4%B9%85%E5%8C%96"><span class="nav-number">6.</span> <span class="nav-text">RDD的持久化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#persist"><span class="nav-number">6.1.</span> <span class="nav-text">persist()</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="进军要努力呀"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">进军要努力呀</p>
  <div class="site-description" itemprop="description">可怕的是自己内心的堕落</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">34</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">19</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/marchboy" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;marchboy" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:jjgdut@gmail.com" title="E-Mail → mailto:jjgdut@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://plus.google.com/yourname" title="Google → https:&#x2F;&#x2F;plus.google.com&#x2F;yourname" rel="noopener" target="_blank"><i class="fab fa-google fa-fw"></i>Google</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://youtube.com/yourname" title="YouTube → https:&#x2F;&#x2F;youtube.com&#x2F;yourname" rel="noopener" target="_blank"><i class="fab fa-youtube fa-fw"></i>YouTube</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://www.cnblogs.com/pinard" title="https:&#x2F;&#x2F;www.cnblogs.com&#x2F;pinard" rel="noopener" target="_blank">刘建平Pinard</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://vel.life/" title="https:&#x2F;&#x2F;vel.life&#x2F;" rel="noopener" target="_blank">思维之海</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://wulc.me/" title="https:&#x2F;&#x2F;wulc.me&#x2F;" rel="noopener" target="_blank">吴良超的学习笔记</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://blog.csdn.net/IT_job" title="https:&#x2F;&#x2F;blog.csdn.net&#x2F;IT_job" rel="noopener" target="_blank">IT_job的博客</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.zdaiot.com/categories/" title="https:&#x2F;&#x2F;www.zdaiot.com&#x2F;categories&#x2F;" rel="noopener" target="_blank">zdaiot</a>
        </li>
    </ul>
  </div>


      </div>
	 <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=320 height=86 
	 src="//music.163.com/outchain/player?type=2&id=463352828&auto=0&height=66">
		    </iframe>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">进军要努力呀</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">142k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">2:09</span>
</div><!-- ����ҳ�ײ�������վ����ʱ�� -->
<span id="timeDate">��������...</span><span id="times">����ʱ����...</span>
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("09/01/2020 00:00:00");//�˴��޸���Ľ�վʱ�������վ����ʱ��
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "Run for "+dnum+" Days ";
        document.getElementById("times").innerHTML = hnum + " Hours " + mnum + " m " + snum + " s";
    }
setInterval("createtime()",250);
</script>



        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>




  
<script src="/js/local-search.js"></script>













  

  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : '9de70fca612487225ccc',
      clientSecret: 'c5242111211342b5c4846f7f261816d1940d3996',
      repo        : 'marchboy.github.io',
      owner       : 'marchboy',
      admin       : ['marchboy'],
      id          : '1812998c89c0f63a3acd1f49d54193a0',
        language: '',
      distractionFreeMode: false
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'qAoqMWohGTiECb1RgaNqvgNB-MdYXbMMI',
      appKey     : 'ISI8QFSo7GcRyExPHSjMkz7R',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
